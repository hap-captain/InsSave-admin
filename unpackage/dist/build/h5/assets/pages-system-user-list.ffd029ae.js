var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,n=(e,n)=>{for(var s in n||(n={}))a.call(n,s)&&l(e,s,n[s]);if(t)for(var s of t(n))i.call(n,s)&&l(e,s,n[s]);return e};import{V as s,S as o,G as r,E as d,am as u,f as c,g,o as p,c as h,w as m,j as f,m as b,t as _,q as y,s as x,F as C,e as k,I as T,N as $,i as v,v as S,d as z}from"./vendor.8a7e56dc.js";import{_ as w}from"./download-excel.9c88b454.js";import{_ as D,d as j,e as I,f as P,h as q,i as E,k as O}from"./index.756c4e22.js";import{_ as V}from"./uni-link.4eb67183.js";import{_ as F}from"./uni-tag.e7d16144.js";import{_ as L}from"./uni-dateformat.2590bfb1.js";import{_ as M}from"./uni-pagination.7b89d6b3.js";import{_ as A}from"./unicloud-db.b2ba4b2a.js";import{_ as N}from"./uni-data-checkbox.9cd6b092.js";import{e as U,f as W}from"./uni-id-users.9ea0ddbf.js";const B=s.database(),R=["username","role.role_name","mobile","email"],G={ascending:"asc",descending:"desc"};var H=D({data:()=>({query:"",where:"",orderby:"register_date desc",orderByFieldName:"",selectedIndexs:[],pageSizeIndex:0,pageSizeOption:[20,50,100,500],tags:{},managerTags:[],queryTagid:"",options:n({pageSize:20,pageCurrent:1,filterData:{status_localdata:[{text:"正常",value:0,checked:!0},{text:"禁用",value:1},{text:"审核中",value:2},{text:"审核拒绝",value:3}]}},U),imageStyles:{width:64,height:64},exportExcel:{filename:"uni-id-users.xls",type:"xls",fields:{"用户名":"username","手机号码":"mobile","用户状态":"status","邮箱":"email","角色":"role",register_date:"register_date"}},exportExcelData:[],noAppidWhatShouldIDoLink:"https://uniapp.dcloud.net.cn/uniCloud/uni-id?id=makeup-dcloud-appid"}),onLoad(e){this._filter={};const t=e.tagid;if(t){this.queryTagid=t;const e={filterType:"select",filter:[t]};this.filterChange(e,"tags")}},onReady(){this.loadTags(),this.queryTagid||this.$refs.udb.loadData()},watch:{pageSizeIndex:{immediate:!0,handler(e,t){this.options.pageSize=this.pageSizeOption[e],this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))}}},computed:{tagsData(){const e=[];for(const t in this.tags){const a={value:t,text:this.tags[t]};t===this.queryTagid&&(a.checked=!0),e.push(a)}return e}},methods:{onqueryload(e){for(var t=0;t<e.length;t++){let a=e[t];const i=a.role.map((e=>e.role_name));a.role=i.join("、");const l=a.tags&&a.tags.map((e=>this.tags[e]));a.tags=l,Array.isArray(a.dcloud_appid)&&(a.dcloud_appid=a.dcloud_appid.join("、")),a.register_date=this.$formatDate(a.register_date)}this.exportExcelData=e},changeSize(e){this.pageSizeIndex=e.detail.value},openTagsPopup(){this.$refs.tagsPopup.open()},closeTagsPopup(){this.$refs.tagsPopup.close()},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return R.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){o({url:e,events:{refreshData:()=>{this.loadTags(),this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+G[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=W(this._filter,B.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))},loadTags(){B.collection("uni-id-tag").limit(500).get().then((e=>{e.result.data.map((e=>{this.tags[e.tagid]=e.name}))})).catch((e=>{r({title:"提示",content:e.message,showCancel:!1})}))},managerMultiTag(e){const t={type:e,ids:this.selectedItems(),value:this.managerTags};this.$request("managerMultiTag",t,{functionName:"uni-id-cf"}).then((e=>{d({title:"修改标签成功",duration:2e3}),this.$refs.table.clearSelection(),this.managerTags=[],this.loadData(),this.closeTagsPopup()})).catch((e=>{r({content:e.message||"请求服务失败",showCancel:!1})})).finally((e=>{u()}))}}},[["render",function(e,t,a,i,l,n){const s=k,o=T,r=$,d=c(g("download-excel"),w),u=c(g("uni-th"),j),D=c(g("uni-tr"),I),U=c(g("uni-td"),P),W=c(g("uni-link"),V),B=c(g("uni-tag"),F),R=c(g("uni-dateformat"),L),G=c(g("uni-table"),q),H=v,J=c(g("uni-icons"),E),K=S,Q=c(g("uni-pagination"),M),X=c(g("unicloud-db"),A),Y=c(g("uni-data-checkbox"),N),Z=c(g("uni-popup"),O);return p(),h(s,{class:"fix-top-window"},{default:m((()=>[f(s,{class:"uni-header"},{default:m((()=>[f(s,{class:"uni-group hide-on-phone"},{default:m((()=>[f(s,{class:"uni-title"},{default:m((()=>[b(_(e.$t("user.text.userManager")),1)])),_:1}),f(s,{class:"uni-sub-title"})])),_:1}),f(s,{class:"uni-group"},{default:m((()=>[f(o,{class:"uni-search",type:"text",modelValue:l.query,"onUpdate:modelValue":t[0]||(t[0]=e=>l.query=e),onConfirm:n.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),f(r,{class:"uni-button",type:"default",size:"mini",onClick:n.search},{default:m((()=>[b(_(e.$t("common.button.search")),1)])),_:1},8,["onClick"]),f(r,{class:"uni-button",type:"primary",size:"mini",onClick:t[1]||(t[1]=e=>n.navigateTo("./add"))},{default:m((()=>[b(_(e.$t("common.button.add")),1)])),_:1}),f(r,{class:"uni-button",type:"warn",size:"mini",disabled:!l.selectedIndexs.length,onClick:n.delTable},{default:m((()=>[b(_(e.$t("common.button.batchDelete")),1)])),_:1},8,["disabled","onClick"]),f(r,{class:"uni-button",type:"primary",size:"mini",disabled:!l.selectedIndexs.length,onClick:n.openTagsPopup},{default:m((()=>[b("标签管理")])),_:1},8,["disabled","onClick"]),f(d,{class:"hide-on-phone",fields:l.exportExcel.fields,data:l.exportExcelData,type:l.exportExcel.type,name:l.exportExcel.filename},{default:m((()=>[f(r,{class:"uni-button",type:"primary",size:"mini"},{default:m((()=>[b(_(e.$t("common.button.exportExcel")),1)])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),f(s,{class:"uni-container"},{default:m((()=>[f(X,{ref:"udb",collection:"uni-id-users,uni-id-roles",field:"username,mobile,status,email,role{role_name},dcloud_appid,tags,register_date",where:l.where,"page-data":"replace",orderby:l.orderby,getcount:!0,"page-size":l.options.pageSize,"page-current":l.options.pageCurrent,options:l.options,loadtime:"manual",onLoad:n.onqueryload},{default:m((({data:a,pagination:i,loading:o,error:d,options:c})=>[f(G,{ref:"table",loading:o,emptyText:d.message||e.$t("common.empty"),border:"",stripe:"",type:"selection",onSelectionChange:n.selectionChange},{default:m((()=>[f(D,null,{default:m((()=>[f(u,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>n.filterChange(e,"username")),sortable:"",onSortChange:t[3]||(t[3]=e=>n.sortChange(e,"username"))},{default:m((()=>[b("用户名")])),_:1}),f(u,{align:"center","filter-type":"search",onFilterChange:t[4]||(t[4]=e=>n.filterChange(e,"mobile")),sortable:"",onSortChange:t[5]||(t[5]=e=>n.sortChange(e,"mobile"))},{default:m((()=>[b("手机号码")])),_:1}),f(u,{align:"center","filter-type":"select","filter-data":c.filterData.status_localdata,onFilterChange:t[6]||(t[6]=e=>n.filterChange(e,"status"))},{default:m((()=>[b("用户状态")])),_:2},1032,["filter-data"]),f(u,{align:"center","filter-type":"search",onFilterChange:t[7]||(t[7]=e=>n.filterChange(e,"email")),sortable:"",onSortChange:t[8]||(t[8]=e=>n.sortChange(e,"email"))},{default:m((()=>[b("邮箱")])),_:1}),f(u,{align:"center"},{default:m((()=>[b("角色")])),_:1}),f(u,{align:"center","filter-type":"select","filter-data":n.tagsData,onFilterChange:t[9]||(t[9]=e=>n.filterChange(e,"tags"))},{default:m((()=>[b("用户标签")])),_:1},8,["filter-data"]),f(u,{align:"center"},{default:m((()=>[b("可登录应用")])),_:1}),f(u,{align:"center","filter-type":"timestamp",onFilterChange:t[10]||(t[10]=e=>n.filterChange(e,"register_date")),sortable:"",onSortChange:t[11]||(t[11]=e=>n.sortChange(e,"register_date"))},{default:m((()=>[b("注册时间")])),_:1}),f(u,{align:"center"},{default:m((()=>[b("操作")])),_:1})])),_:2},1024),(p(!0),y(C,null,x(a,((t,a)=>(p(),h(D,{key:a},{default:m((()=>[f(U,{align:"center"},{default:m((()=>[b(_(t.username),1)])),_:2},1024),f(U,{align:"center"},{default:m((()=>[b(_(t.mobile),1)])),_:2},1024),f(U,{align:"center"},{default:m((()=>[b(_(c.status_valuetotext[t.status]),1)])),_:2},1024),f(U,{align:"center"},{default:m((()=>[f(W,{href:"mailto:"+t.email,text:t.email},null,8,["href","text"])])),_:2},1024),f(U,{align:"center"},{default:m((()=>[b(_(t.role),1)])),_:2},1024),f(U,{align:"center"},{default:m((()=>[t.tags?(p(!0),y(C,{key:0},x(t.tags,(e=>(p(),h(B,{type:"primary",inverted:"",size:"small",text:e,style:{margin:"0 5px"}},null,8,["text"])))),256)):z("",!0)])),_:2},1024),f(U,{align:"center"},{default:m((()=>[void 0===t.dcloud_appid?(p(),h(W,{key:0,href:l.noAppidWhatShouldIDoLink},{default:m((()=>[b(" 未绑定可登录应用"),f(s,{class:"uni-icons-help"})])),_:1},8,["href"])):z("",!0),b(" "+_(t.dcloud_appid),1)])),_:2},1024),f(U,{align:"center"},{default:m((()=>[f(R,{threshold:[0,0],date:t.register_date},null,8,["date"])])),_:2},1024),f(U,{align:"center"},{default:m((()=>[f(s,{class:"uni-group"},{default:m((()=>[f(r,{onClick:e=>n.navigateTo("./edit?id="+t._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:m((()=>[b(_(e.$t("common.button.edit")),1)])),_:2},1032,["onClick"]),f(r,{onClick:e=>n.confirmDelete(t._id),class:"uni-button",size:"mini",type:"warn"},{default:m((()=>[b(_(e.$t("common.button.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),f(s,{class:"uni-pagination-box"},{default:m((()=>[f(K,{class:"select-picker",mode:"selector",value:l.pageSizeIndex,range:l.pageSizeOption,onChange:n.changeSize},{default:m((()=>[f(r,{type:"default",size:"mini",plain:!0},{default:m((()=>[f(H,null,{default:m((()=>[b(_(l.pageSizeOption[l.pageSizeIndex])+" "+_(e.$t("common.piecePerPage")),1)])),_:1}),f(J,{class:"select-picker-icon",type:"arrowdown",size:"12",color:"#999"})])),_:1})])),_:1},8,["value","range","onChange"]),f(Q,{"show-icon":"","page-size":i.size,modelValue:i.current,"onUpdate:modelValue":e=>i.current=e,total:i.count,onChange:n.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["where","orderby","page-size","page-current","options","onLoad"])])),_:1}),f(Z,{ref:"tagsPopup",type:"center"},{default:m((()=>[f(s,{class:"tags-manager--x"},{default:m((()=>[f(s,{class:"tags-manager--header mb"},{default:m((()=>[b("管理标签")])),_:1}),f(Y,{ref:"checkbox",modelValue:l.managerTags,"onUpdate:modelValue":t[12]||(t[12]=e=>l.managerTags=e),class:"mb ml",multiple:!0,collection:"uni-id-tag",field:"tagid as value, name as text"},null,8,["modelValue"]),f(s,{class:"uni-group"},{default:m((()=>[f(r,{onClick:t[13]||(t[13]=e=>n.managerMultiTag("add")),class:"uni-button",type:"primary",style:{"margin-right":"75px"}},{default:m((()=>[b("添加")])),_:1}),f(r,{onClick:t[14]||(t[14]=e=>n.managerMultiTag("del")),class:"uni-button",type:"warn"},{default:m((()=>[b("删除")])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1})}],["__scopeId","data-v-2cc32690"]]);export{H as default};
