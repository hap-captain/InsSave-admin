var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(e,t,l)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,n=(a,e)=>{for(var t in e||(e={}))s.call(e,t)&&r(a,t,e[t]);if(l)for(var t of l(e))o.call(e,t)&&r(a,t,e[t]);return a};import{V as i,S as d,al as u,E as m,M as c,G as f,am as p,f as b,g as h,o as g,c as w,w as D,j as _,y,z as V,B as k,m as x,t as v,e as C,ar as j,N as P,D as O}from"./vendor.8a7e56dc.js";import{_ as U}from"./uni-easyinput.9b1df50f.js";import{_ as T,a as L,b as A}from"./index.756c4e22.js";import{_ as S}from"./uni-data-checkbox.9cd6b092.js";import{v as $}from"./uni-id-users.9ea0ddbf.js";const I=i.database();I.command;function N(a){let e={};for(let t in $)a.includes(t)&&(e[t]=$[t]);return e}var q=T({data(){return{showPassword:!1,formData:{username:"",password:"",role:[],dcloud_appid:[],mobile:"",email:"",status:!1},rules:(a=n({},N(["username","password","role","mobile","email"])),l={status:{rules:[{format:"bool"}]}},e(a,t(l))),roles:[]};var a,l},onLoad(a){const e=a.id;this.formDataId=e,this.getDetail(e),this.loadroles()},methods:{gotoAppList(){d({url:"../app/list"})},gotoTagList(){d({url:"../tag/list"})},gotoTagAdd(){d({url:"../tag/add",events:{refreshCheckboxData:()=>{this.$refs.checkbox.loadData()}}})},trigger(){this.showPassword=!this.showPassword},submitForm(a){this.$refs.form.submit()},submit(a){const{value:e,errors:t}=a.detail;t||(u({title:"修改中...",mask:!0}),"boolean"==typeof e.status&&(e.status=Number(!e.status)),e.id=this.formDataId,this.$request("updateUser",e,{functionName:"uni-id-cf"}).then((a=>{m({title:"修改成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>c()),500)})).catch((a=>{f({content:a.message||"请求服务失败",showCancel:!1})})).finally((a=>{p()})))},resetPWd(a){this.$request("system/user/resetPwd",a).then().catch((a=>{f({content:a.message||"请求服务失败",showCancel:!1})})).finally()},getDetail(a){u({mask:!0}),I.collection("uni-id-users").doc(a).field("username,role,dcloud_appid,tags,mobile,email,status").get().then((a=>{const e=a.result.data[0];e&&(void 0===e.status&&(e.status=!0),0===e.status&&(e.status=!0),1===e.status&&(e.status=!1),this.formData=Object.assign(this.formData,e))})).catch((a=>{f({content:a.message||"请求服务失败",showCancel:!1})})).finally((()=>{p()}))},loadroles(){I.collection("uni-id-roles").limit(500).get().then((a=>{const e=[];this.roles=a.result.data.map((a=>(e.push(a.role_id),{value:a.role_id,text:a.role_name}))),-1===e.indexOf("admin")&&this.roles.unshift({value:"admin",text:"超级管理员"})})).catch((a=>{f({title:"提示",content:a.message,showCancel:!1})}))},parseUserStatus:a=>0===a?"启用":1===a?"禁用":2===a?"审核中":3===a?"审核拒绝":"启用"}},[["render",function(a,e,t,l,s,o){const r=b(h("uni-easyinput"),U),n=b(h("uni-forms-item"),L),i=C,d=b(h("uni-data-checkbox"),S),u=j,m=P,c=O,f=b(h("uni-forms"),A);return g(),w(i,{class:"uni-container"},{default:D((()=>[_(f,{ref:"form",modelValue:s.formData,"onUpdate:modelValue":e[12]||(e[12]=a=>s.formData=a),rules:s.rules,validateTrigger:"bind",onSubmit:o.submit},{default:D((()=>[_(n,{name:"username",label:"用户名",required:""},{default:D((()=>[_(r,{modelValue:s.formData.username,"onUpdate:modelValue":e[0]||(e[0]=a=>s.formData.username=a),clearable:!1,placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),_(n,{name:s.showPassword?"password":"",label:"重置密码"},{default:D((()=>[y(k("span",{class:"reset-password-btn",onClick:e[1]||(e[1]=(...a)=>o.trigger&&o.trigger(...a))},"点击重置密码",512),[[V,!s.showPassword]]),y(_(r,{modelValue:s.formData.password,"onUpdate:modelValue":e[2]||(e[2]=a=>s.formData.password=a),clearable:!1,placeholder:"请输入重置密码"},{default:D((()=>[_(i,{slot:"right",class:"cancel-reset-password-btn",onClick:o.trigger},{default:D((()=>[x("取消")])),_:1},8,["onClick"])])),_:1},8,["modelValue"]),[[V,s.showPassword]])])),_:1},8,["name"]),_(n,{name:"role",label:"角色列表",class:"flex-center-x"},{default:D((()=>[_(d,{multiple:"",localdata:s.roles,modelValue:s.formData.role,"onUpdate:modelValue":e[3]||(e[3]=a=>s.formData.role=a)},null,8,["localdata","modelValue"])])),_:1}),_(n,{name:"tags",label:"用户标签",labelWidth:"100",class:"flex-center-x"},{default:D((()=>[_(d,{multiple:!0,modelValue:s.formData.tags,"onUpdate:modelValue":e[4]||(e[4]=a=>s.formData.tags=a),collection:"uni-id-tag",field:"tagid as value, name as text"},null,8,["modelValue"]),k("span",{class:"link-btn",onClick:e[5]||(e[5]=(...a)=>o.gotoTagAdd&&o.gotoTagAdd(...a))},"新增"),k("span",{class:"link-btn",onClick:e[6]||(e[6]=(...a)=>o.gotoTagList&&o.gotoTagList(...a)),style:{"margin-left":"10px"}},"管理")])),_:1}),_(n,{name:"dcloud_appid",label:"可登录应用",class:"flex-center-x"},{default:D((()=>[_(d,{multiple:!0,modelValue:s.formData.dcloud_appid,"onUpdate:modelValue":e[7]||(e[7]=a=>s.formData.dcloud_appid=a),collection:"opendb-app-list",field:"appid as value, name as text"},null,8,["modelValue"]),k("span",{class:"link-btn",onClick:e[8]||(e[8]=(...a)=>o.gotoAppList&&o.gotoAppList(...a))},"管理")])),_:1}),_(n,{name:"mobile",label:"手机号"},{default:D((()=>[_(r,{modelValue:s.formData.mobile,"onUpdate:modelValue":e[9]||(e[9]=a=>s.formData.mobile=a),clearable:!1,placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),_(n,{name:"email",label:"邮箱"},{default:D((()=>[_(r,{modelValue:s.formData.email,"onUpdate:modelValue":e[10]||(e[10]=a=>s.formData.email=a),clearable:!1,placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),_(n,{name:"status",label:"用户状态"},{default:D((()=>[Number(s.formData.status)<2?(g(),w(u,{key:0,onChange:e[11]||(e[11]=e=>a.binddata("status",e.detail.value)),checked:s.formData.status},null,8,["checked"])):(g(),w(i,{key:1,class:"uni-form-item-empty"},{default:D((()=>[x(v(o.parseUserStatus(s.formData.status)),1)])),_:1}))])),_:1}),_(i,{class:"uni-button-group"},{default:D((()=>[_(m,{style:{width:"100px"},type:"primary",class:"uni-button",onClick:o.submitForm},{default:D((()=>[x(v(a.$t("common.button.submit")),1)])),_:1},8,["onClick"]),_(c,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:D((()=>[_(m,{style:{width:"100px"},class:"uni-button"},{default:D((()=>[x(v(a.$t("common.button.back")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-8a49fcf0"]]);export{q as default};
