var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a;import{o as u,c as r,w as o,r as d,a as c,n as p,m as f,t as m,d as g,i as h,e as _,V as b,W as y,S as x,G as v,al as M,am as w,f as C,g as T,j as S,y as k,z as j,q as $,s as z,F as D,N as O}from"./vendor.8a7e56dc.js";import{_ as N,j as P,d as I,e as E,f as L,h as B}from"./index.756c4e22.js";import{_ as q}from"./unicloud-db.b2ba4b2a.js";var R=N({name:"UniBadge",emits:["click"],props:{type:{type:String,default:"default"},inverted:{type:Boolean,default:!1},isDot:{type:Boolean,default:!1},maxNum:{type:Number,default:99},absolute:{type:String,default:""},offset:{type:Array,default:()=>[0,0]},text:{type:[String,Number],default:""},size:{type:String,default:"normal"},customStyle:{type:Object,default:()=>({})}},data:()=>({}),computed:{width(){return 8*String(this.text).length+12},classNames(){const{inverted:e,type:t,size:n,absolute:a}=this;return[e?"uni-badge--"+t+"-inverted":"","uni-badge--"+t,"uni-badge--"+n,a?"uni-badge--absolute":""].join(" ")},positionStyle(){if(!this.absolute)return{};let e=this.width/2,t=10;this.isDot&&(e=5,t=5);const n=`${-e+this.offset[0]}px`,a=`${-t+this.offset[1]}px`,s={rightTop:{right:n,top:a},rightBottom:{right:n,bottom:a},leftBottom:{left:n,bottom:a},leftTop:{left:n,top:a}},i=s[this.absolute];return i||s.rightTop},badgeWidth(){return{width:`${this.width}px`}},dotStyle(){return this.isDot?{width:"10px",height:"10px",borderRadius:"10px"}:{}},displayValue(){const{isDot:e,text:t,maxNum:n}=this;return e?"":Number(t)>n?`${n}+`:t}},methods:{onClick(){this.$emit("click")}}},[["render",function(e,t,n,a,s,i){const l=h,b=_;return u(),r(b,{class:"uni-badge--x"},{default:o((()=>[d(e.$slots,"default",{},void 0,!0),n.text?(u(),r(l,{key:0,class:c([i.classNames,"uni-badge"]),style:p([i.badgeWidth,i.positionStyle,n.customStyle,i.dotStyle]),onClick:t[0]||(t[0]=e=>i.onClick())},{default:o((()=>[f(m(i.displayValue),1)])),_:1},8,["class","style"])):g("",!0)])),_:3})}],["__scopeId","data-v-34e8ea4e"]]);b.database();const U=[];function V(e,t,n=0){return e.forEach((a=>{a.menu_id===t&&a.parent_id&&(n=n+1+V(e,a.parent_id,n))})),n}function W(e,t,n=[]){return e.find((e=>e.parent_id===t))&&e.forEach((a=>{a.parent_id===t&&(n.push(a._id),W(e,a.menu_id,n))})),n}const F={data:()=>({query:"",where:"",orderby:"create_date asc",options:{pageSize:2e4,pageCurrent:1},selectedIndexs:[],loading:!0,menus:[],errMsg:"",currentTab:"menus",selectedPluginMenuIndexs:[]}),computed:{pluginMenus(){const e=[];if(!this.$hasRole("admin"))return e;const t=this.menus;return t.length?(U.forEach((n=>{t.find((e=>e.menu_id===n.menu_id))||e.push(n)})),e):e}},watch:{pluginMenus(e){e.length||(this.currentTab="menus")}},methods:(J=((e,t)=>{for(var n in t||(t={}))s.call(t,n)&&l(e,n,t[n]);if(a)for(var n of a(t))i.call(t,n)&&l(e,n,t[n]);return e})({},y({init:"app/init"})),A={getSortMenu:e=>(e.map((t=>{e.some((e=>e.parent_id===t.menu_id))||(t.isLeafNode=!0)})),P(e)),onqueryload(e){for(var t=0;t<e.length;t++){let n=e[t];const a=V(e,n.menu_id);n.name=(a?"　".repeat(a)+"|-":"")+n.name}const n=this.getSortMenu(e),a=[];this.patTree(n,a),e.length=0,e.push(...a),this.menus=e},patTree(e,t){return e.forEach((e=>{t.push(e),e.children.length&&this.patTree(e.children,t)})),t},switchTab(e){this.currentTab=e},loadData(e=!0){this.$refs.udb.loadData({clear:e})},navigateTo(e,t){x({url:e,events:{refreshData:()=>{this.loadData(t)}}})},confirmDelete(e){let t=e._id,n="是否删除该菜单？";const a=W(this.menus,e.menu_id);a.length&&(n="是否删除该菜单及其子菜单？"),t=[t,...a],v({title:"提示",content:n,success:e=>{e.confirm&&this.$refs.udb.remove(t,{needConfirm:!1})}})},pluginMenuSelectChange(e){this.selectedPluginMenuIndexs=e.detail.index},addPluginMenus(e){if(!this.selectedPluginMenuIndexs.length)return v({title:"提示",content:"请选择要添加的菜单！",showCancel:!1});const t=this.pluginMenus,n=[];this.selectedPluginMenuIndexs.forEach((e=>{const a=t[e];if(a){const e=JSON.parse(JSON.stringify(a));delete e.json,n.push(e)}})),v({title:"提示",content:"您确认要添加已选中的菜单吗？",success:e=>{if(!e.confirm)return;M({mask:!0});const a=n.length===t.length;b.database().collection("opendb-admin-menus").add(n).then((e=>{this.init(),v({title:"提示",content:"添加菜单成功！",showCancel:!1,success:()=>{this.$refs.pluginMenusTable.clearSelection(),a&&(this.currentTab="menus"),this.loadData()}})})).catch((e=>{v({title:"提示",content:e.message,showCancel:!1})})).finally((()=>{w()}))}})}},t(J,n(A)))};var J,A;var G=N(F,[["render",function(e,t,n,a,s,i){const l=_,d=C(T("uni-badge"),R),p=O,h=C(T("uni-th"),I),b=C(T("uni-tr"),E),y=C(T("uni-td"),L),x=C(T("uni-table"),B),v=C(T("unicloud-db"),q);return u(),r(l,null,{default:o((()=>[S(l,{class:"uni-tabs__header"},{default:o((()=>[S(l,{class:"uni-tabs__nav-wrap"},{default:o((()=>[S(l,{class:"uni-tabs__nav-scroll"},{default:o((()=>[S(l,{class:"uni-tabs__nav"},{default:o((()=>[S(l,{onClick:t[0]||(t[0]=e=>i.switchTab("menus")),class:c([{"is-active":"menus"===s.currentTab},"uni-tabs__item"])},{default:o((()=>[f(m(e.$t("menu.text.menuManager")),1)])),_:1},8,["class"]),i.pluginMenus.length?(u(),r(l,{key:0,onClick:t[1]||(t[1]=e=>i.switchTab("pluginMenus")),class:c([{"is-active":"pluginMenus"===s.currentTab},"uni-tabs__item"])},{default:o((()=>[f(m(e.$t("menu.text.additiveMenu"))+" ",1),S(d,{class:"menu-badge",text:i.pluginMenus.length,type:"error"},null,8,["text"])])),_:1},8,["class"])):g("",!0)])),_:1})])),_:1})])),_:1})])),_:1}),k(S(l,null,{default:o((()=>[S(l,{class:"uni-header",style:{"border-bottom":"0","margin-bottom":"-15px"}},{default:o((()=>[S(l,{class:"uni-group"},{default:o((()=>[S(p,{onClick:t[2]||(t[2]=e=>i.navigateTo("./add")),size:"mini",plain:"true",type:"primary"},{default:o((()=>[f(m(e.$t("menu.button.addFirstLevelMenu")),1)])),_:1})])),_:1}),S(l,{class:"uni-group"})])),_:1}),S(l,{class:"uni-container"},{default:o((()=>[S(v,{ref:"udb",onLoad:i.onqueryload,collection:"opendb-admin-menus",options:s.options,where:s.where,"page-data":"replace",orderby:s.orderby,getcount:!0,"page-size":s.options.pageSize,"page-current":s.options.pageCurrent},{default:o((({data:t,pagination:n,loading:a,error:d})=>[S(x,{loading:a,class:"table-pc",emptyText:s.errMsg||e.$t("common.empty"),border:"",stripe:""},{default:o((()=>[S(b,null,{default:o((()=>[S(h,{align:"center"},{default:o((()=>[f("排序")])),_:1}),S(h,{width:"200",align:"center"},{default:o((()=>[f("名称")])),_:1}),S(h,{align:"center"},{default:o((()=>[f("标识")])),_:1}),S(h,{align:"center"},{default:o((()=>[f("URL")])),_:1}),S(h,{width:"100",align:"center"},{default:o((()=>[f("是否启用")])),_:1}),S(h,{align:"center"},{default:o((()=>[f("操作")])),_:1})])),_:1}),(u(!0),$(D,null,z(t,((t,n)=>(u(),r(b,{key:n},{default:o((()=>[S(y,{align:"center"},{default:o((()=>[f(m(t.sort),1)])),_:2},1024),S(y,null,{default:o((()=>[f(m(t.name),1)])),_:2},1024),S(y,null,{default:o((()=>[f(m(t.menu_id),1)])),_:2},1024),S(y,null,{default:o((()=>[f(m(t.url),1)])),_:2},1024),S(y,{align:"center",class:c({"menu-disable":!t.enable})},{default:o((()=>[f(m(t.enable?"已启用":"未启用"),1)])),_:2},1032,["class"]),S(y,{align:"center"},{default:o((()=>[S(l,{class:"uni-group"},{default:o((()=>[t.url?g("",!0):(u(),r(p,{key:0,onClick:e=>i.navigateTo("./add?parent_id="+t.menu_id,!1),class:"uni-button",size:"mini",type:"primary"},{default:o((()=>[f(m(e.$t("menu.button.addChildMenu")),1)])),_:2},1032,["onClick"])),S(p,{onClick:e=>i.navigateTo("./edit?id="+t._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:o((()=>[f(m(e.$t("common.button.edit")),1)])),_:2},1032,["onClick"]),"system_menu"!==t.menu_id&&"system_management"!==t.menu_id?(u(),r(p,{key:1,onClick:e=>i.confirmDelete(t),class:"uni-button",size:"mini",type:"warn"},{default:o((()=>[f(m(e.$t("common.button.delete")),1)])),_:2},1032,["onClick"])):g("",!0)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText"])])),_:1},8,["onLoad","options","where","orderby","page-size","page-current"])])),_:1})])),_:1},512),[[j,"menus"===s.currentTab]]),k(S(l,null,{default:o((()=>[S(l,{class:"uni-header",style:{"border-bottom":"0","margin-bottom":"-15px"}},{default:o((()=>[S(l,{class:"uni-group"},{default:o((()=>[S(p,{style:{width:"130px"},onClick:i.addPluginMenus,size:"mini",type:"primary"},{default:o((()=>[f("添加选中的菜单")])),_:1},8,["onClick"])])),_:1}),S(l,{class:"uni-group"})])),_:1}),S(l,{class:"uni-container"},{default:o((()=>[S(x,{ref:"pluginMenusTable",type:"selection",border:"",stripe:"",onSelectionChange:i.pluginMenuSelectChange},{default:o((()=>[S(b,null,{default:o((()=>[S(h,{align:"center"},{default:o((()=>[f("名称（标识）")])),_:1}),S(h,{align:"center"},{default:o((()=>[f("URL")])),_:1}),S(h,{align:"center"},{default:o((()=>[f("插件菜单 json 文件")])),_:1})])),_:1}),(u(!0),$(D,null,z(i.pluginMenus,((e,t)=>(u(),r(b,{key:t},{default:o((()=>[S(y,null,{default:o((()=>[f(m(e.name)+"（"+m(e.menu_id)+"）",1)])),_:2},1024),S(y,null,{default:o((()=>[f(m(e.url),1)])),_:2},1024),S(y,null,{default:o((()=>[f(m(e.json),1)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["onSelectionChange"]),S(l,{class:"uni-sub-title",style:{"margin-top":"15px"}},{default:o((()=>[f(" 以上待添加菜单来自于三方插件，添加后，将显示在菜单管理中，若不希望显示在上述表格中时，可手动删除项目中对应的`插件id-menu.json`文件。 ")])),_:1})])),_:1})])),_:1},512),[[j,"pluginMenus"===s.currentTab]])])),_:1})}],["__scopeId","data-v-7aa7fa31"]]);export{G as default};
