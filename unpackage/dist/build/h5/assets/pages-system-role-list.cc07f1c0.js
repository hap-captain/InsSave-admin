var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,o=(e,o)=>{for(var r in o||(o={}))a.call(o,r)&&i(e,r,o[r]);if(t)for(var r of t(o))n.call(o,r)&&i(e,r,o[r]);return e};import{V as r,S as l,f as s,g as d,o as c,c as u,w as p,j as m,m as h,t as f,q as g,s as _,F as b,e as y,I as x,N as C,i as z,v as S}from"./vendor.8a7e56dc.js";import{_ as $}from"./download-excel.9c88b454.js";import{_ as w,d as D,e as v,f as k,h as I,i as j}from"./index.756c4e22.js";import{_ as T}from"./uni-dateformat.2590bfb1.js";import{_ as O}from"./uni-pagination.7b89d6b3.js";import{_ as E}from"./unicloud-db.b2ba4b2a.js";import{e as q,f as V}from"./uni-id-roles.26b50b24.js";const F=r.database(),P=["role_id","role_name","permission.permission_name"],L={ascending:"asc",descending:"desc"};var N=w({data:()=>({query:"",where:"",orderby:"create_date desc",orderByFieldName:"",selectedIndexs:[],pageSizeIndex:0,pageSizeOption:[20,50,100,500],options:o({pageSize:20,pageCurrent:1,filterData:{}},q),imageStyles:{width:64,height:64},exportExcel:{filename:"uni-id-roles.xls",type:"xls",fields:{"唯一ID":"role_id","名称":"role_name","权限":"permission","备注":"comment",create_date:"create_date"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},watch:{pageSizeIndex:{immediate:!0,handler(e,t){this.options.pageSize=this.pageSizeOption[e],this.options.pageCurrent=1}}},methods:{onqueryload(e){for(var t=0;t<e.length;t++){let a=e[t];a.permission=a.permission.map((e=>e.permission_name)).join("、"),a.create_date=this.$formatDate(a.create_date)}this.exportExcelData=e},changeSize(e){this.pageSizeIndex=e.detail.value,this.$nextTick((()=>{this.loadData()}))},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return P.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){l({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+L[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=V(this._filter,F.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,n,i,o){const r=y,l=x,w=C,q=s(d("download-excel"),$),V=s(d("uni-th"),D),F=s(d("uni-tr"),v),P=s(d("uni-td"),k),L=s(d("uni-dateformat"),T),N=s(d("uni-table"),I),U=z,B=s(d("uni-icons"),j),R=S,W=s(d("uni-pagination"),O),M=s(d("unicloud-db"),E);return c(),u(r,{class:"fix-top-window"},{default:p((()=>[m(r,{class:"uni-header"},{default:p((()=>[m(r,{class:"uni-group hide-on-phone"},{default:p((()=>[m(r,{class:"uni-title"},{default:p((()=>[h(f(e.$t("role.text.roleManager")),1)])),_:1}),m(r,{class:"uni-sub-title"})])),_:1}),m(r,{class:"uni-group"},{default:p((()=>[m(l,{class:"uni-search",type:"text",modelValue:i.query,"onUpdate:modelValue":t[0]||(t[0]=e=>i.query=e),onConfirm:o.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),m(w,{class:"uni-button",type:"default",size:"mini",onClick:o.search},{default:p((()=>[h(f(e.$t("common.button.search")),1)])),_:1},8,["onClick"]),m(w,{class:"uni-button",type:"primary",size:"mini",onClick:t[1]||(t[1]=e=>o.navigateTo("./add"))},{default:p((()=>[h(f(e.$t("common.button.add")),1)])),_:1}),m(w,{class:"uni-button",type:"warn",size:"mini",disabled:!i.selectedIndexs.length,onClick:o.delTable},{default:p((()=>[h(f(e.$t("common.button.batchDelete")),1)])),_:1},8,["disabled","onClick"]),m(q,{class:"hide-on-phone",fields:i.exportExcel.fields,data:i.exportExcelData,type:i.exportExcel.type,name:i.exportExcel.filename},{default:p((()=>[m(w,{class:"uni-button",type:"primary",size:"mini"},{default:p((()=>[h(f(e.$t("common.button.exportExcel")),1)])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),m(r,{class:"uni-container"},{default:p((()=>[m(M,{ref:"udb",collection:"uni-id-roles,uni-id-permissions",field:"role_id,role_name,permission{permission_name},comment,create_date",where:i.where,"page-data":"replace",orderby:i.orderby,getcount:!0,"page-size":i.options.pageSize,"page-current":i.options.pageCurrent,options:i.options,loadtime:"manual",onLoad:o.onqueryload},{default:p((({data:a,pagination:n,loading:l,error:s,options:d})=>[m(N,{ref:"table",loading:l,emptyText:s.message||e.$t("common.empty"),border:"",stripe:"",type:"selection",onSelectionChange:o.selectionChange},{default:p((()=>[m(F,null,{default:p((()=>[m(V,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>o.filterChange(e,"role_id")),sortable:"",onSortChange:t[3]||(t[3]=e=>o.sortChange(e,"role_id"))},{default:p((()=>[h("唯一ID")])),_:1}),m(V,{align:"center","filter-type":"search",onFilterChange:t[4]||(t[4]=e=>o.filterChange(e,"role_name")),sortable:"",onSortChange:t[5]||(t[5]=e=>o.sortChange(e,"role_name"))},{default:p((()=>[h("名称")])),_:1}),m(V,{align:"center"},{default:p((()=>[h("权限")])),_:1}),m(V,{align:"center","filter-type":"search",onFilterChange:t[6]||(t[6]=e=>o.filterChange(e,"comment")),sortable:"",onSortChange:t[7]||(t[7]=e=>o.sortChange(e,"comment"))},{default:p((()=>[h("备注")])),_:1}),m(V,{align:"center","filter-type":"timestamp",onFilterChange:t[8]||(t[8]=e=>o.filterChange(e,"create_date")),sortable:"",onSortChange:t[9]||(t[9]=e=>o.sortChange(e,"create_date"))},{default:p((()=>[h("创建时间")])),_:1}),m(V,{align:"center"},{default:p((()=>[h("操作")])),_:1})])),_:1}),(c(!0),g(b,null,_(a,((t,a)=>(c(),u(F,{key:a},{default:p((()=>[m(P,{align:"center"},{default:p((()=>[h(f(t.role_id),1)])),_:2},1024),m(P,{align:"center"},{default:p((()=>[h(f(t.role_name),1)])),_:2},1024),m(P,{align:"center"},{default:p((()=>[h(f(t.permission),1)])),_:2},1024),m(P,{align:"center"},{default:p((()=>[h(f(t.comment),1)])),_:2},1024),m(P,{align:"center"},{default:p((()=>[m(L,{threshold:[0,0],date:t.create_date},null,8,["date"])])),_:2},1024),m(P,{align:"center"},{default:p((()=>[m(r,{class:"uni-group"},{default:p((()=>[m(w,{onClick:e=>o.navigateTo("./edit?id="+t._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:p((()=>[h(f(e.$t("common.button.edit")),1)])),_:2},1032,["onClick"]),m(w,{onClick:e=>o.confirmDelete(t._id),class:"uni-button",size:"mini",type:"warn"},{default:p((()=>[h(f(e.$t("common.button.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),m(r,{class:"uni-pagination-box"},{default:p((()=>[m(R,{class:"select-picker",mode:"selector",value:i.pageSizeIndex,range:i.pageSizeOption,onChange:o.changeSize},{default:p((()=>[m(w,{type:"default",size:"mini",plain:!0},{default:p((()=>[m(U,null,{default:p((()=>[h(f(i.pageSizeOption[i.pageSizeIndex])+" "+f(e.$t("common.piecePerPage")),1)])),_:1}),m(B,{class:"select-picker-icon",type:"arrowdown",size:"12",color:"#999"})])),_:1})])),_:1},8,["value","range","onChange"]),m(W,{"show-icon":"","page-size":n.size,modelValue:n.current,"onUpdate:modelValue":e=>n.current=e,total:n.count,onChange:o.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{N as default};
