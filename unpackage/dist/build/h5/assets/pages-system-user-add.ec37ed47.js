var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&r(e,l,a[l]);return e};import{V as d,S as u,al as i,E as m,M as c,G as p,am as f,f as b,g,o as h,c as _,w as V,j as D,B as x,m as v,t as y,ar as k,N as w,D as j,e as O}from"./vendor.8a7e56dc.js";import{_ as C}from"./uni-easyinput.9b1df50f.js";import{_ as U,a as T,b as L}from"./index.756c4e22.js";import{_ as A}from"./uni-data-checkbox.9cd6b092.js";import{v as P}from"./uni-id-users.9ea0ddbf.js";const $=d.database();function S(e){let a={};for(let l in P)e.includes(l)&&(a[l]=P[l]);return a}$.command;var q=U({data(){return{formData:{username:"",password:"",role:[],dcloud_appid:[],tags:[],mobile:"",email:"",status:!0},rules:(e=n({},S(["username","password","role","mobile","email"])),t={status:{rules:[{format:"bool"}]}},a(e,l(t))),roles:[]};var e,t},onLoad(){this.loadroles()},methods:{gotoAppList(){u({url:"../app/list"})},gotoTagList(){u({url:"../tag/list"})},gotoTagAdd(){u({url:"../tag/add",events:{refreshCheckboxData:()=>{this.$refs.checkbox.loadData()}}})},submitForm(){this.$refs.form.submit()},submit(e){const{value:a,errors:l}=e.detail;l||(i({title:"提交中...",mask:!0}),"boolean"==typeof a.status&&(a.status=Number(!a.status)),this.$request("registerUser",a,{functionName:"uni-id-cf"}).then((e=>{m({title:"新增成功"}),this.getOpenerEventChannel().emit("refreshData"),setTimeout((()=>c()),500)})).catch((e=>{p({content:e.message||"请求服务失败",showCancel:!1})})).finally((e=>{f()})))},loadroles(){$.collection("uni-id-roles").limit(500).get().then((e=>{const a=[];this.roles=e.result.data.map((e=>(a.push(e.role_id),{value:e.role_id,text:e.role_name}))),-1===a.indexOf("admin")&&this.roles.unshift({value:"admin",text:"超级管理员"})})).catch((e=>{p({title:"提示",content:e.message,showCancel:!1})}))}}},[["render",function(e,a,l,t,o,s){const r=b(g("uni-easyinput"),C),n=b(g("uni-forms-item"),T),d=b(g("uni-data-checkbox"),A),u=k,i=w,m=j,c=O,p=b(g("uni-forms"),L);return h(),_(c,{class:"uni-container"},{default:V((()=>[D(p,{ref:"form",modelValue:o.formData,"onUpdate:modelValue":a[11]||(a[11]=e=>o.formData=e),rules:o.rules,validateTrigger:"bind",onSubmit:s.submit},{default:V((()=>[D(n,{name:"username",label:"用户名",required:""},{default:V((()=>[D(r,{modelValue:o.formData.username,"onUpdate:modelValue":a[0]||(a[0]=e=>o.formData.username=e),clearable:!1,placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),D(n,{name:"password",label:"初始密码",required:""},{default:V((()=>[D(r,{modelValue:o.formData.password,"onUpdate:modelValue":a[1]||(a[1]=e=>o.formData.password=e),clearable:!1,placeholder:"请输入初始密码"},null,8,["modelValue"])])),_:1}),D(n,{name:"role",label:"角色列表",class:"flex-center-x"},{default:V((()=>[D(d,{multiple:"",localdata:o.roles,modelValue:o.formData.role,"onUpdate:modelValue":a[2]||(a[2]=e=>o.formData.role=e)},null,8,["localdata","modelValue"])])),_:1}),D(n,{name:"tags",label:"用户标签",labelWidth:"100",class:"flex-center-x"},{default:V((()=>[D(d,{ref:"checkbox",multiple:!0,modelValue:o.formData.tags,"onUpdate:modelValue":a[3]||(a[3]=e=>o.formData.tags=e),collection:"uni-id-tag",field:"tagid as value, name as text"},null,8,["modelValue"]),x("span",{class:"link-btn",onClick:a[4]||(a[4]=(...e)=>s.gotoTagAdd&&s.gotoTagAdd(...e))},"新增"),x("span",{class:"link-btn",onClick:a[5]||(a[5]=(...e)=>s.gotoTagList&&s.gotoTagList(...e)),style:{"margin-left":"10px"}},"管理")])),_:1}),D(n,{name:"dcloud_appid",label:"可登录应用",labelWidth:"100",class:"flex-center-x"},{default:V((()=>[D(d,{multiple:!0,modelValue:o.formData.dcloud_appid,"onUpdate:modelValue":a[6]||(a[6]=e=>o.formData.dcloud_appid=e),collection:"opendb-app-list",field:"appid as value, name as text"},null,8,["modelValue"]),x("span",{class:"link-btn",onClick:a[7]||(a[7]=(...e)=>s.gotoAppList&&s.gotoAppList(...e))},"管理")])),_:1}),D(n,{name:"mobile",label:"手机号"},{default:V((()=>[D(r,{modelValue:o.formData.mobile,"onUpdate:modelValue":a[8]||(a[8]=e=>o.formData.mobile=e),clearable:!1,placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),D(n,{name:"email",label:"邮箱"},{default:V((()=>[D(r,{modelValue:o.formData.email,"onUpdate:modelValue":a[9]||(a[9]=e=>o.formData.email=e),clearable:!1,placeholder:"请输入邮箱"},null,8,["modelValue"])])),_:1}),D(n,{name:"status",label:"是否启用"},{default:V((()=>[D(u,{onChange:a[10]||(a[10]=a=>e.binddata("status",a.detail.value)),checked:o.formData.status},null,8,["checked"])])),_:1}),D(c,{class:"uni-button-group"},{default:V((()=>[D(i,{style:{width:"100px"},type:"primary",class:"uni-button",onClick:s.submitForm},{default:V((()=>[v(y(e.$t("common.button.submit")),1)])),_:1},8,["onClick"]),D(m,{"open-type":"navigateBack",style:{"margin-left":"15px"}},{default:V((()=>[D(i,{style:{width:"100px"},class:"uni-button"},{default:V((()=>[v(y(e.$t("common.button.back")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","rules","onSubmit"])])),_:1})}],["__scopeId","data-v-3f2dd00a"]]);export{q as default};
