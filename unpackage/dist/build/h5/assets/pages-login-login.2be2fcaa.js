var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,t,s)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[t]=s,r=(e,a)=>{for(var t in a||(a={}))n.call(a,t)&&i(e,t,a[t]);if(s)for(var t of s(a))o.call(a,t)&&i(e,t,a[t]);return e},l=(e,s)=>a(e,t(s));import{af as c,W as d,K as u,E as m,ag as p,X as h,G as f,f as g,g as b,o as w,c as C,w as y,j as k,m as _,t as x,a as P,q as D,d as V,T as v,e as O,I as L,i as $,N as j}from"./vendor.8a7e56dc.js";import{_ as F,g as I,c as q,a as E,b as M}from"./index.756c4e22.js";const U={deviceId:I(),scene:"login"};var B=F({data:()=>l(r({},q.navBar),{indexPage:q.index.url,showPassword:!0,loading:!1,formData:{username:"",password:"",captcha:""},captchaLoading:!1,needCaptcha:!1,captchaBase64:"",rules:{username:{rules:[{required:!0,errorMessage:"请输入账户"},{minLength:1,maxLength:30,errorMessage:"账户长度在{minLength}到{maxLength}个字符"}]},password:{rules:[{required:!0,errorMessage:"请输入正确的密码"},{minLength:6,errorMessage:"密码长度大于{minLength}个字符"}]},captcha:{rules:[{required:!0,errorMessage:"请输入验证码"}]}}}),mounted(){const e=this;c({key:"lastUsername",success:function(a){e.formData.username=a.data}})},methods:l(r(r({},d({init:"app/init"})),u({setToken(e,a){e("user/SET_TOKEN",a)}})),{submit(e){if(this.loading)return;const{errors:a,value:t}=e.detail;a||(this.loading=!0,this.$request("login",l(r({},t),{captchaOptions:U}),{functionName:"uni-id-cf",showModal:!1}).then((e=>(this.setToken({token:e.token,tokenExpired:e.tokenExpired}),this.init().then((()=>{m({title:"登录成功",icon:"none"}),p({key:"lastUsername",data:t.username}),h({url:this.indexPage})}))))).catch((e=>{e.needCaptcha&&(this.formData.captcha="",this.createCaptcha(),this.needCaptcha=!0),f({content:e.message||"请求服务失败",showCancel:!1,success:function(){}})})).finally((e=>{this.loading=!1})))},createCaptcha(){this.captchaLoading=!0,this.$request("createCaptcha",U,{functionName:"uni-id-cf"}).then((e=>{0===e.code&&(this.captchaBase64=e.captchaBase64)})).catch((e=>{})).finally((e=>{this.captchaLoading=!1}))},confirmForm(e,a){this.submitForm()},submitForm(){this.$refs.form.submit()},initAdmin(){h({url:"/pages/demo/init/init"})},changePassword:function(){this.showPassword=!this.showPassword},focus:function(){this.$refs.usernameInput.$refs.input.focus()}})},[["render",function(e,a,t,s,n,o){const i=v,r=O,l=L,c=g(b("uni-forms-item"),E),d=$,u=j,m=g(b("uni-forms"),M);return w(),C(r,{class:"login-box"},{default:y((()=>[k(r,{class:"admin-logo"},{default:y((()=>[k(i,{src:e.logo,mode:"heightFix"},null,8,["src"])])),_:1}),k(r,{class:"uni-header no-padding"},{default:y((()=>[k(r,{class:"uni-title"},{default:y((()=>[_(x(e.$t("login.text.title")),1)])),_:1})])),_:1}),k(r,{class:"uni-container"},{default:y((()=>[k(m,{ref:"form",modelValue:n.formData,"onUpdate:modelValue":a[3]||(a[3]=e=>n.formData=e),rules:n.rules,onSubmit:o.submit},{default:y((()=>[k(c,{"left-icon":"person-filled",name:"username",labelWidth:"35"},{default:y((()=>[k(l,{ref:"usernameInput",onConfirm:o.submitForm,class:"uni-input-border",type:"text",placeholder:e.$t("login.field.username"),modelValue:n.formData.username,"onUpdate:modelValue":a[0]||(a[0]=e=>n.formData.username=e)},null,8,["onConfirm","placeholder","modelValue"])])),_:1}),k(c,{"left-icon":"locked-filled",class:"icon-container",name:"password",labelWidth:"35"},{default:y((()=>[k(l,{ref:"passwordInput",onConfirm:o.submitForm,class:"uni-input-border",password:n.showPassword,placeholder:e.$t("login.field.password"),modelValue:n.formData.password,"onUpdate:modelValue":a[1]||(a[1]=e=>n.formData.password=e)},null,8,["onConfirm","password","placeholder","modelValue"]),k(d,{class:P(["uni-icon-password-eye pointer",[n.showPassword?"":"uni-eye-active"]]),onClick:o.changePassword},{default:y((()=>[_("")])),_:1},8,["class","onClick"])])),_:1}),n.needCaptcha?(w(),C(c,{key:0,"left-icon":"image",class:"icon-container",name:"captcha",labelWidth:"35"},{default:y((()=>[k(l,{ref:"captchaInput",onConfirm:o.submitForm,class:"uni-input-border",type:"text",placeholder:e.$t("login.field.captcha"),modelValue:n.formData.captcha,"onUpdate:modelValue":a[2]||(a[2]=e=>n.formData.captcha=e)},null,8,["onConfirm","placeholder","modelValue"]),k(r,{class:"admin-captcha-img pointer",onClick:o.createCaptcha},{default:y((()=>[n.captchaLoading?(w(),D("i",{key:0,class:"uni-loading"})):(w(),D("img",{key:1,src:n.captchaBase64,style:{width:"120px",height:"32px"}},null,8,["src"]))])),_:1},8,["onClick"])])),_:1})):V("",!0),k(r,{class:"uni-button-group"},{default:y((()=>[k(u,{class:"uni-button uni-button-full",type:"primary",loading:n.loading,disabled:n.loading,onClick:o.submitForm},{default:y((()=>[_(x(e.$t("login.button.login")),1)])),_:1},8,["loading","disabled","onClick"])])),_:1})])),_:1},8,["modelValue","rules","onSubmit"]),k(r,{class:"uni-tips"},{default:y((()=>[k(d,{class:"uni-tips-text",onClick:o.initAdmin},{default:y((()=>[_("测试账号：admin 密码：123456")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-13a5d8b9"]]);export{B as default};
