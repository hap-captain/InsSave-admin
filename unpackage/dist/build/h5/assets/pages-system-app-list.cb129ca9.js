var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,o=(e,o)=>{for(var s in o||(o={}))t.call(o,s)&&n(e,s,o[s]);if(a)for(var s of a(o))i.call(o,s)&&n(e,s,o[s]);return e};import{V as s,C as l,G as r,S as d,f as p,g as c,o as u,c as h,w as g,j as f,m,t as b,q as y,s as _,F as C,e as x,I as S,N as z,i as w,v as $}from"./vendor.8a7e56dc.js";import{_ as D,d as k,e as v,f as I,h as j,i as T}from"./index.756c4e22.js";import{_ as O}from"./uni-dateformat.2590bfb1.js";import{_ as q}from"./uni-pagination.7b89d6b3.js";import{_ as A}from"./unicloud-db.b2ba4b2a.js";import{e as L,f as V}from"./opendb-app-list.be57fa91.js";const F=s.database(),P=[],N={ascending:"asc",descending:"desc"};var E=D({data:()=>({query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],pageSizeIndex:0,pageSizeOption:[20,50,100,500],options:o({pageSize:20,pageCurrent:1,filterData:{}},L),imageStyles:{width:64,height:64},exportExcel:{filename:"opendb-app-list.xls",type:"xls",fields:{AppID:"appid","应用名称":"name","应用描述":"description","创建时间":"create_date"}},exportExcelData:[],addAppidLoading:!0}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},computed:o({},l("app",["appName","appid"])),watch:{pageSizeIndex:{immediate:!0,handler(e,a){this.options.pageSize=this.pageSizeOption[e],this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))}}},methods:{onqueryload(e){e.find((e=>e.appid===this.appid))?this.addAppidLoading=!1:this.addCurrentAppid({appid:this.appid,name:this.appName,description:"admin 管理后台",create_date:Date.now()}),this.exportExcelData=e},changeSize(e){this.pageSizeIndex=e.detail.value},addCurrentAppid(e){F.collection("opendb-app-list").add(e).then((e=>{this.loadData(),setTimeout((()=>{r({content:`检测到数据库中无当前应用, 已自动添加应用: ${this.appName}`,showCancel:!1})}),500)})).catch((e=>{})).finally((()=>{this.addAppidLoading=!1}))},getWhere(){const e=this.query.trim();if(!e)return"";const a=new RegExp(e,"i");return P.map((e=>a+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.loadData()},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,a){d({url:e,events:{refreshData:()=>{this.loadData(a)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((a=>e[a]._id))},delTable(){console.warn("删除应用，只能删除应用表 opendb-app-list 中的应用数据记录，不能删除与应用关联的其他数据，例如：使用升级中心 uni-upgrade-center 等插件产生的数据（应用版本数据等）"),this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){console.warn("删除应用，只能删除应用表 opendb-app-list 中的应用数据记录，不能删除与应用关联的其他数据，例如：使用升级中心 uni-upgrade-center 等插件产生的数据（应用版本数据等）"),this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,a){this.orderByFieldName=a,e.order?this.orderby=a+" "+N[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,a){this._filter[a]={type:e.filterType,value:e.filter};let t=V(this._filter,F.command);Object.keys(t).length?this.where=t:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,a,t,i,n,o){const s=x,l=S,r=z,d=p(c("uni-th"),k),D=p(c("uni-tr"),v),L=p(c("uni-td"),I),V=p(c("uni-dateformat"),O),F=p(c("uni-table"),j),P=w,N=p(c("uni-icons"),T),E=$,U=p(c("uni-pagination"),q),B=p(c("unicloud-db"),A);return u(),h(s,{class:"fix-top-window"},{default:g((()=>[f(s,{class:"uni-header"},{default:g((()=>[f(s,{class:"uni-group hide-on-phone"},{default:g((()=>[f(s,{class:"uni-title"}),f(s,{class:"uni-sub-title"},{default:g((()=>[m(b(e.$t("app.text.describle")),1)])),_:1})])),_:1}),f(s,{class:"uni-group"},{default:g((()=>[f(l,{class:"uni-search",type:"text",modelValue:n.query,"onUpdate:modelValue":a[0]||(a[0]=e=>n.query=e),onConfirm:o.search,placeholder:e.$t("common.placeholder.query")},null,8,["modelValue","onConfirm","placeholder"]),f(r,{class:"uni-button",type:"default",size:"mini",onClick:o.search},{default:g((()=>[m(b(e.$t("common.button.search")),1)])),_:1},8,["onClick"]),f(r,{class:"uni-button",type:"primary",size:"mini",onClick:a[1]||(a[1]=e=>o.navigateTo("./add"))},{default:g((()=>[m(b(e.$t("common.button.add")),1)])),_:1}),f(r,{class:"uni-button",type:"warn",size:"mini",disabled:!n.selectedIndexs.length,onClick:o.delTable},{default:g((()=>[m(b(e.$t("common.button.batchDelete")),1)])),_:1},8,["disabled","onClick"])])),_:1})])),_:1}),f(s,{class:"uni-container"},{default:g((()=>[f(B,{ref:"udb",collection:"opendb-app-list",field:"appid,name,description,create_date",where:n.where,"page-data":"replace",orderby:n.orderby,getcount:!0,"page-size":n.options.pageSize,"page-current":n.options.pageCurrent,options:n.options,loadtime:"manual",onLoad:o.onqueryload},{default:g((({data:t,pagination:i,loading:l,error:p,options:c})=>[f(F,{ref:"table",loading:l||n.addAppidLoading,emptyText:p.message||e.$t("common.empty"),border:"",stripe:"",type:"selection",onSelectionChange:o.selectionChange,class:"table-pc"},{default:g((()=>[f(D,null,{default:g((()=>[f(d,{align:"center","filter-type":"search",onFilterChange:a[2]||(a[2]=e=>o.filterChange(e,"appid")),sortable:"",onSortChange:a[3]||(a[3]=e=>o.sortChange(e,"appid"))},{default:g((()=>[m("AppID")])),_:1}),f(d,{align:"center","filter-type":"search",onFilterChange:a[4]||(a[4]=e=>o.filterChange(e,"name")),sortable:"",onSortChange:a[5]||(a[5]=e=>o.sortChange(e,"name"))},{default:g((()=>[m("应用名称")])),_:1}),f(d,{align:"center","filter-type":"search",onFilterChange:a[6]||(a[6]=e=>o.filterChange(e,"description")),sortable:"",onSortChange:a[7]||(a[7]=e=>o.sortChange(e,"description"))},{default:g((()=>[m("应用描述")])),_:1}),f(d,{align:"center","filter-type":"timestamp",onFilterChange:a[8]||(a[8]=e=>o.filterChange(e,"create_date")),sortable:"",onSortChange:a[9]||(a[9]=e=>o.sortChange(e,"create_date"))},{default:g((()=>[m("创建时间")])),_:1}),f(d,{align:"center"},{default:g((()=>[m("操作")])),_:1})])),_:1}),(u(!0),y(C,null,_(t,((a,t)=>(u(),h(D,{key:t},{default:g((()=>[f(L,{align:"center"},{default:g((()=>[m(b(a.appid),1)])),_:2},1024),f(L,{align:"center"},{default:g((()=>[m(b(a.name),1)])),_:2},1024),f(L,{align:"center"},{default:g((()=>[m(b(a.description),1)])),_:2},1024),f(L,{align:"center"},{default:g((()=>[f(V,{threshold:[0,0],date:a.create_date},null,8,["date"])])),_:2},1024),f(L,{align:"center"},{default:g((()=>[a.appid===e.appid?(u(),h(s,{key:0},{default:g((()=>[m(" - ")])),_:1})):(u(),h(s,{key:1,class:"uni-group"},{default:g((()=>[f(r,{onClick:e=>o.navigateTo("./edit?id="+a._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:g((()=>[m(b(e.$t("common.button.edit\t")),1)])),_:2},1032,["onClick"]),f(r,{onClick:e=>o.confirmDelete(a._id),class:"uni-button",size:"mini",type:"warn"},{default:g((()=>[m(b(e.$t("common.button.delete")),1)])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),f(s,{class:"uni-pagination-box"},{default:g((()=>[f(E,{class:"select-picker",mode:"selector",value:n.pageSizeIndex,range:n.pageSizeOption,onChange:o.changeSize},{default:g((()=>[f(r,{type:"default",size:"mini",plain:!0},{default:g((()=>[f(P,null,{default:g((()=>[m(b(n.pageSizeOption[n.pageSizeIndex])+" "+b(e.$t("common.piecePerPage")),1)])),_:1}),f(N,{class:"select-picker-icon",type:"arrowdown",size:"12",color:"#999"})])),_:1})])),_:1},8,["value","range","onChange"]),f(U,{"show-icon":"","page-size":i.size,modelValue:i.current,"onUpdate:modelValue":e=>i.current=e,total:i.count,onChange:o.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{E as default};
