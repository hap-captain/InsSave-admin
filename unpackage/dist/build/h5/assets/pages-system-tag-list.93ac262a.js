var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,n=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,l=(e,l)=>{for(var s in l||(l={}))a.call(l,s)&&n(e,s,l[s]);if(t)for(var s of t(l))i.call(l,s)&&n(e,s,l[s]);return e};import{V as s,S as r,f as o,g as d,o as c,c as u,w as p,j as g,m as h,q as f,s as m,F as b,t as y,e as _,I as x,N as C,i as z,v as S}from"./vendor.8a7e56dc.js";import{_ as w}from"./download-excel.9c88b454.js";import{_ as v,d as k,e as $,f as D,h as j,i as I}from"./index.756c4e22.js";import{_ as T}from"./uni-tag.e7d16144.js";import{_ as O}from"./uni-dateformat.2590bfb1.js";import{_ as E}from"./uni-pagination.7b89d6b3.js";import{_ as V}from"./unicloud-db.b2ba4b2a.js";import{e as q,f as F}from"./uni-id-tag.a8ae40f1.js";const P=s.database(),L=[],N={ascending:"asc",descending:"desc"};var U=v({data:()=>({query:"",where:"",orderby:"",orderByFieldName:"",selectedIndexs:[],pageSizeIndex:0,pageSizeOption:[20,50,100,500],options:l({pageSize:20,pageCurrent:1,filterData:{}},q),imageStyles:{width:64,height:64},exportExcel:{filename:"uni-id-tag.xls",type:"xls",fields:{"标签的tagid":"tagid","标签名称":"name","标签描述":"description"}},exportExcelData:[]}),onLoad(){this._filter={}},onReady(){this.$refs.udb.loadData()},watch:{pageSizeIndex:{immediate:!0,handler(e,t){this.options.pageSize=this.pageSizeOption[e],this.options.pageCurrent=1,this.$nextTick((()=>{this.loadData()}))}}},methods:{onqueryload(e){this.exportExcelData=e},changeSize(e){this.pageSizeIndex=e.detail.value},getWhere(){const e=this.query.trim();if(!e)return"";const t=new RegExp(e,"i");return L.map((e=>t+".test("+e+")")).join(" || ")},search(){const e=this.getWhere();this.where=e,this.$nextTick((()=>{this.loadData()}))},loadData(e=!0){this.$refs.udb.loadData({clear:e})},onPageChanged(e){this.selectedIndexs.length=0,this.$refs.table.clearSelection(),this.$refs.udb.loadData({current:e.current})},navigateTo(e,t){r({url:e,events:{refreshData:()=>{this.loadData(t)}}})},selectedItems(){var e=this.$refs.udb.dataList;return this.selectedIndexs.map((t=>e[t]._id))},delTable(){this.$refs.udb.remove(this.selectedItems(),{success:e=>{this.$refs.table.clearSelection()}})},selectionChange(e){this.selectedIndexs=e.detail.index},confirmDelete(e){this.$refs.udb.remove(e,{success:e=>{this.$refs.table.clearSelection()}})},sortChange(e,t){this.orderByFieldName=t,e.order?this.orderby=t+" "+N[e.order]:this.orderby="",this.$refs.table.clearSelection(),this.$nextTick((()=>{this.$refs.udb.loadData()}))},filterChange(e,t){this._filter[t]={type:e.filterType,value:e.filter};let a=F(this._filter,P.command);Object.keys(a).length?this.where=a:this.where="",this.$nextTick((()=>{this.$refs.udb.loadData()}))}}},[["render",function(e,t,a,i,n,l){const s=_,r=x,v=C,q=o(d("download-excel"),w),F=o(d("uni-th"),k),P=o(d("uni-tr"),$),L=o(d("uni-td"),D),N=o(d("uni-tag"),T),U=o(d("uni-dateformat"),O),B=o(d("uni-table"),j),R=z,W=o(d("uni-icons"),I),A=S,G=o(d("uni-pagination"),E),H=o(d("unicloud-db"),V);return c(),u(s,{class:"fix-top-window"},{default:p((()=>[g(s,{class:"uni-header"},{default:p((()=>[g(s,{class:"uni-group hide-on-phone"},{default:p((()=>[g(s,{class:"uni-title"},{default:p((()=>[h("标签管理")])),_:1}),g(s,{class:"uni-sub-title"})])),_:1}),g(s,{class:"uni-group"},{default:p((()=>[g(r,{class:"uni-search",type:"text",modelValue:n.query,"onUpdate:modelValue":t[0]||(t[0]=e=>n.query=e),onConfirm:l.search,placeholder:"请输入搜索内容"},null,8,["modelValue","onConfirm"]),g(v,{class:"uni-button",type:"default",size:"mini",onClick:l.search},{default:p((()=>[h("搜索")])),_:1},8,["onClick"]),g(v,{class:"uni-button",type:"primary",size:"mini",onClick:t[1]||(t[1]=e=>l.navigateTo("./add"))},{default:p((()=>[h("新增")])),_:1}),g(v,{class:"uni-button",type:"warn",size:"mini",disabled:!n.selectedIndexs.length,onClick:l.delTable},{default:p((()=>[h("批量删除")])),_:1},8,["disabled","onClick"]),g(q,{class:"hide-on-phone",fields:n.exportExcel.fields,data:n.exportExcelData,type:n.exportExcel.type,name:n.exportExcel.filename},{default:p((()=>[g(v,{class:"uni-button",type:"primary",size:"mini"},{default:p((()=>[h("导出 Excel")])),_:1})])),_:1},8,["fields","data","type","name"])])),_:1})])),_:1}),g(s,{class:"uni-container"},{default:p((()=>[g(H,{ref:"udb",collection:"uni-id-tag",field:"tagid,name,description,create_date",where:n.where,"page-data":"replace",orderby:n.orderby,getcount:!0,"page-size":n.options.pageSize,"page-current":n.options.pageCurrent,options:n.options,loadtime:"manual",onLoad:l.onqueryload},{default:p((({data:a,pagination:i,loading:r,error:o,options:d})=>[g(B,{ref:"table",loading:r,emptyText:o.message||"没有更多数据",border:"",stripe:"",type:"selection",onSelectionChange:l.selectionChange},{default:p((()=>[g(P,null,{default:p((()=>[g(F,{align:"center","filter-type":"search",onFilterChange:t[2]||(t[2]=e=>l.filterChange(e,"tagid")),sortable:"",onSortChange:t[3]||(t[3]=e=>l.sortChange(e,"tagid"))},{default:p((()=>[h("标签的tagid")])),_:1}),g(F,{align:"center","filter-type":"search",onFilterChange:t[4]||(t[4]=e=>l.filterChange(e,"name")),sortable:"",onSortChange:t[5]||(t[5]=e=>l.sortChange(e,"name"))},{default:p((()=>[h("标签名称")])),_:1}),g(F,{align:"center","filter-type":"search",onFilterChange:t[6]||(t[6]=e=>l.filterChange(e,"description")),sortable:"",onSortChange:t[7]||(t[7]=e=>l.sortChange(e,"description"))},{default:p((()=>[h("标签描述")])),_:1}),g(F,{align:"center","filter-type":"timestamp",onFilterChange:t[8]||(t[8]=e=>l.filterChange(e,"create_date")),sortable:"",onSortChange:t[9]||(t[9]=e=>l.sortChange(e,"create_date"))},{default:p((()=>[h("创建时间")])),_:1}),g(F,{align:"center"},{default:p((()=>[h("操作")])),_:1})])),_:1}),(c(!0),f(b,null,m(a,((e,t)=>(c(),u(P,{key:t},{default:p((()=>[g(L,{align:"center"},{default:p((()=>[h(y(e.tagid),1)])),_:2},1024),g(L,{align:"center"},{default:p((()=>[g(N,{type:"primary",inverted:"",size:"small",text:e.name},null,8,["text"])])),_:2},1024),g(L,{align:"center"},{default:p((()=>[h(y(e.description),1)])),_:2},1024),g(L,{align:"center"},{default:p((()=>[g(U,{threshold:[0,0],date:e.create_date},null,8,["date"])])),_:2},1024),g(L,{align:"center"},{default:p((()=>[g(s,{class:"uni-group"},{default:p((()=>[g(v,{onClick:t=>l.navigateTo("../user/list?tagid="+e.tagid,!1),class:"uni-button",size:"mini",type:"primary"},{default:p((()=>[h("成员")])),_:2},1032,["onClick"]),g(v,{onClick:t=>l.navigateTo("./edit?id="+e._id,!1),class:"uni-button",size:"mini",type:"primary"},{default:p((()=>[h("修改")])),_:2},1032,["onClick"]),g(v,{onClick:t=>l.confirmDelete(e._id),class:"uni-button",size:"mini",type:"warn"},{default:p((()=>[h("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1032,["loading","emptyText","onSelectionChange"]),g(s,{class:"uni-pagination-box"},{default:p((()=>[g(A,{class:"select-picker",mode:"selector",value:n.pageSizeIndex,range:n.pageSizeOption,onChange:l.changeSize},{default:p((()=>[g(v,{type:"default",size:"mini",plain:!0},{default:p((()=>[g(R,null,{default:p((()=>[h(y(n.pageSizeOption[n.pageSizeIndex])+" "+y(e.$t("common.piecePerPage")),1)])),_:1}),g(W,{class:"select-picker-icon",type:"arrowdown",size:"12",color:"#999"})])),_:1})])),_:1},8,["value","range","onChange"]),g(G,{"show-icon":"","page-size":i.size,modelValue:i.current,"onUpdate:modelValue":e=>i.current=e,total:i.count,onChange:l.onPageChanged},null,8,["page-size","modelValue","onUpdate:modelValue","total","onChange"])])),_:2},1024)])),_:1},8,["where","orderby","page-size","page-current","options","onLoad"])])),_:1})])),_:1})}]]);export{U as default};
